{
  "hash": "5ef859e0c0bfb131f424606ed9758dde",
  "result": {
    "engine": "knitr",
    "markdown": "---\ntitle: \"Screening and Diagnostic Tests\"\n---\n\n# Screening and Diagnostic Tests {#sec-screening-diagnostic}\n\n\n\n## Introduction\n\nIn clinical practice it is desirable to have a simple test which, depending on the presence or absence of an indicator (for example, faecal occult blood), provides a good prediction to whether or not a patient has a particular condition (for example, colorectal cancer).\n\nTo evaluate a potential diagnostic test, we apply the test to a group of individuals whose true disease status is known. We then draw up a **2 × 2 table** of frequencies.\n\n## The 2 × 2 Table\n\n\n::: {#tbl-2x2 .cell tbl-cap='Structure of a 2 × 2 table for evaluating diagnostic tests'}\n\n```{.r .cell-code}\ntwo_by_two <- tibble(\n  ` ` = c(\"Test positive\", \"Test negative\", \"**Total**\"),\n  `Disease` = c(\"a (true positive)\", \"c (false negative)\", \"**a + c**\"),\n  `No disease` = c(\"b (false positive)\", \"d (true negative)\", \"**b + d**\"),\n  `Total` = c(\"a + b\", \"c + d\", \"**n = a + b + c + d**\")\n)\n\ntwo_by_two |>\n  kable(escape = FALSE) |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\")) |>\n  add_header_above(c(\" \" = 1, \"True Disease Status\" = 2, \" \" = 1))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">True Disease Status</div></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:left;\"> Disease </th>\n   <th style=\"text-align:left;\"> No disease </th>\n   <th style=\"text-align:left;\"> Total </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Test positive </td>\n   <td style=\"text-align:left;\"> a (true positive) </td>\n   <td style=\"text-align:left;\"> b (false positive) </td>\n   <td style=\"text-align:left;\"> a + b </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Test negative </td>\n   <td style=\"text-align:left;\"> c (false negative) </td>\n   <td style=\"text-align:left;\"> d (true negative) </td>\n   <td style=\"text-align:left;\"> c + d </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> **Total** </td>\n   <td style=\"text-align:left;\"> **a + c** </td>\n   <td style=\"text-align:left;\"> **b + d** </td>\n   <td style=\"text-align:left;\"> **n = a + b + c + d** </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\nOf the **n** individuals studied:\n\n- **a + c** individuals have the disease\n- **b + d** do not have the disease\n\n## Sensitivity and Specificity\n\n**Sensitivity**, **specificity** and **predictive values** are measures for assessing the effectiveness of the test.\n\n### Sensitivity\n\n**Sensitivity** is the proportion of individuals **with the disease** who are correctly identified by the test.\n\n$$\\text{Sensitivity} = \\frac{a}{a + c}$$\n\nA highly sensitive test will detect most people with the disease (few false negatives).\n\n### Specificity\n\n**Specificity** is the proportion of individuals **without the disease** who are correctly identified by the test.\n\n$$\\text{Specificity} = \\frac{d}{b + d}$$\n\nA highly specific test will correctly identify most people without the disease (few false positives).\n\n::: {.callout-note}\n## Key Point\nSensitivity and specificity quantify the **diagnostic ability** of the test. They are properties of the test itself and do not change with disease prevalence.\n:::\n\n## Predictive Values\n\n### Positive Predictive Value\n\n**Positive predictive value (PPV)** is the proportion of individuals with a positive test result who have the disease.\n\n$$\\text{Positive predictive value} = \\frac{a}{a + b}$$\n\n### Negative Predictive Value\n\n**Negative predictive value (NPV)** is the proportion of individuals with a negative test result who do not have the disease.\n\n$$\\text{Negative predictive value} = \\frac{d}{c + d}$$\n\nThe predictive values indicate **how likely it is that the individual has or does not have the disease, given the test result**.\n\n### Effect of Prevalence\n\n::: {.callout-important}\n## Prevalence and Predictive Values\nPredictive values are **dependent on the prevalence** of the disease in the population being studied. Prevalence is the proportion of the population who have the disease.\n\n$$\\text{Prevalence} = \\frac{a + c}{n}$$\n\nIn populations where the disease is **common**, the positive predictive value of a given test will be **higher** than in populations where the disease is **rare**.\n:::\n\n## Likelihood Ratios\n\nThe **likelihood ratio (LR)** for a positive test result is the ratio of the probability of a positive result if the patient has the disease (sensitivity) to the probability of a positive result if the patient does not have the disease (1-specificity).\n\n$$\\text{Likelihood ratio} = \\frac{\\text{Sensitivity}}{1 - \\text{Specificity}}$$\n\nFor example, a LR of 4 for a positive result indicates that a positive result is **four times as likely** to occur in an individual with the disease compared to one without it.\n\n## Cut-off Values\n\nSometimes a diagnostic test needs to be performed on the basis of a continuous numerical measurement. Often there is no threshold above (or below) which the disease definitely occurs. In this situation, a **cut-off value** is identified at which it is believed an individual has a very high chance of having the disease.\n\n## ROC Curves\n\nThe **receiver operating characteristic (ROC) curve** provides a way of assessing an optimal cut-off value for a test. A ROC curve plots sensitivity against (1 - specificity) at all potential cut-off points. It essentially compares the probabilities of a positive test result in those with and without disease.\n\nThe overall accuracy can be assessed by the **area under the curve (AUC)**:\n\n- AUC = 0.5: No discrimination (test is no better than chance)\n- AUC = 1.0: Perfect discrimination\n- AUC > 0.7: Generally considered acceptable\n- AUC > 0.8: Good discrimination\n- AUC > 0.9: Excellent discrimination\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Create example ROC curve data\nset.seed(123)\nroc_data <- tibble(\n  specificity = seq(1, 0, by = -0.01),\n  sensitivity = pbeta(1 - specificity, 2, 1)  # Creates a realistic ROC curve shape\n)\n\n# Calculate AUC (approximately)\nauc <- round(mean(roc_data$sensitivity), 2)\n\nggplot(roc_data, aes(x = 1 - specificity, y = sensitivity)) +\n  geom_line(colour = \"#3498db\", linewidth = 1.2) +\n  geom_abline(intercept = 0, slope = 1, linetype = \"dashed\", colour = \"grey50\") +\n  geom_ribbon(aes(ymin = 1 - specificity, ymax = sensitivity), \n              fill = \"#3498db\", alpha = 0.2) +\n  annotate(\"text\", x = 0.6, y = 0.3, \n           label = paste(\"AUC =\", auc), size = 5) +\n  labs(x = \"1 - Specificity (False Positive Rate)\",\n       y = \"Sensitivity (True Positive Rate)\") +\n  coord_equal() +\n  theme_minimal(base_size = 14)\n```\n\n::: {.cell-output-display}\n![Example ROC curve showing trade-off between sensitivity and specificity](10-screening-diagnostic_files/figure-html/fig-roc-1.png){#fig-roc width=672}\n:::\n:::\n\n\n## Worked Example: PSA Testing for Prostate Cancer\n\n\n::: {#tbl-psa-example .cell tbl-cap='PSA test results for prostate cancer detection (threshold ≥2.1 ng/ml)'}\n\n```{.r .cell-code}\npsa_table <- tibble(\n  ` ` = c(\"PSA ≥2.1 ng/ml (positive)\", \"PSA <2.1 ng/ml (negative)\", \"**Total**\"),\n  `Prostate cancer` = c(\"167\", \"282\", \"**449**\"),\n  `No prostate cancer` = c(\"508\", \"1993\", \"**2501**\"),\n  `Total` = c(\"675\", \"2275\", \"**2950**\")\n)\n\npsa_table |>\n  kable(escape = FALSE) |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\")) |>\n  add_header_above(c(\" \" = 1, \"True Disease Status\" = 2, \" \" = 1))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n<tr>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n<th style=\"border-bottom:hidden;padding-bottom:0; padding-left:3px;padding-right:3px;text-align: center; \" colspan=\"2\"><div style=\"border-bottom: 1px solid #ddd; padding-bottom: 5px; \">True Disease Status</div></th>\n<th style=\"empty-cells: hide;border-bottom:hidden;\" colspan=\"1\"></th>\n</tr>\n  <tr>\n   <th style=\"text-align:left;\">  </th>\n   <th style=\"text-align:left;\"> Prostate cancer </th>\n   <th style=\"text-align:left;\"> No prostate cancer </th>\n   <th style=\"text-align:left;\"> Total </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> PSA ≥2.1 ng/ml (positive) </td>\n   <td style=\"text-align:left;\"> 167 </td>\n   <td style=\"text-align:left;\"> 508 </td>\n   <td style=\"text-align:left;\"> 675 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> PSA &lt;2.1 ng/ml (negative) </td>\n   <td style=\"text-align:left;\"> 282 </td>\n   <td style=\"text-align:left;\"> 1993 </td>\n   <td style=\"text-align:left;\"> 2275 </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> **Total** </td>\n   <td style=\"text-align:left;\"> **449** </td>\n   <td style=\"text-align:left;\"> **2501** </td>\n   <td style=\"text-align:left;\"> **2950** </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n### Calculating the Measures\n\n\n::: {.cell}\n\n```{.r .cell-code}\n# Values from the table\na <- 167  # True positive\nb <- 508  # False positive\nc <- 282  # False negative\nd <- 1993 # True negative\nn <- a + b + c + d\n\n# Calculate measures\nsensitivity <- a / (a + c)\nspecificity <- d / (b + d)\nppv <- a / (a + b)\nnpv <- d / (c + d)\nprevalence <- (a + c) / n\nlr <- sensitivity / (1 - specificity)\n```\n:::\n\n\n**Sensitivity:**\n\n$$\\text{Sensitivity} = \\frac{167}{167 + 282} = 0.37$$\n\nUsing this test, if prostate cancer is present there is a **37% chance of detecting it**.\n\n**Specificity:**\n\n$$\\text{Specificity} = \\frac{1993}{508 + 1993} = 0.8$$\n\nIf there is no prostate cancer, there is an **80% chance of a negative result**. 20% of people will have a false positive result.\n\n**Positive Predictive Value:**\n\n$$\\text{PPV} = \\frac{167}{167 + 508} = 0.25$$\n\nThere is a **25% chance** that if the test is positive the patient actually has prostate cancer.\n\n**Negative Predictive Value:**\n\n$$\\text{NPV} = \\frac{1993}{282 + 1993} = 0.88$$\n\nThere is an **88% chance**, if the test is negative, that the patient does not have prostate cancer. This means there is a 12% chance of a false negative result.\n\n**Likelihood Ratio:**\n\n$$\\text{LR} = \\frac{0.37}{1 - 0.8} = 1.83$$\n\nIf the test is positive, the patient is **1.83 times** (almost twice) as likely to have prostate cancer as not have it.\n\n### Summary of Results\n\n\n::: {#tbl-psa-summary .cell tbl-cap='Summary of diagnostic test measures for PSA ≥2.1 ng/ml'}\n\n```{.r .cell-code}\nsummary_table <- tibble(\n  Measure = c(\"Sensitivity\", \"Specificity\", \"Positive Predictive Value\", \n              \"Negative Predictive Value\", \"Prevalence\", \"Likelihood Ratio\"),\n  Value = c(\n    paste0(round(sensitivity * 100, 1), \"%\"),\n    paste0(round(specificity * 100, 1), \"%\"),\n    paste0(round(ppv * 100, 1), \"%\"),\n    paste0(round(npv * 100, 1), \"%\"),\n    paste0(round(prevalence * 100, 1), \"%\"),\n    round(lr, 2)\n  ),\n  Interpretation = c(\n    \"37% of cancers detected\",\n    \"80% of non-cancers correctly identified\",\n    \"25% of positive tests are true cancers\",\n    \"88% of negative tests are truly cancer-free\",\n    \"15% of population has prostate cancer\",\n    \"Positive test ~2× more likely in cancer\"\n  )\n)\n\nsummary_table |>\n  kable() |>\n  kable_styling(bootstrap_options = c(\"striped\", \"hover\"))\n```\n\n::: {.cell-output-display}\n`````{=html}\n<table class=\"table table-striped table-hover\" style=\"margin-left: auto; margin-right: auto;\">\n <thead>\n  <tr>\n   <th style=\"text-align:left;\"> Measure </th>\n   <th style=\"text-align:left;\"> Value </th>\n   <th style=\"text-align:left;\"> Interpretation </th>\n  </tr>\n </thead>\n<tbody>\n  <tr>\n   <td style=\"text-align:left;\"> Sensitivity </td>\n   <td style=\"text-align:left;\"> 37.2% </td>\n   <td style=\"text-align:left;\"> 37% of cancers detected </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Specificity </td>\n   <td style=\"text-align:left;\"> 79.7% </td>\n   <td style=\"text-align:left;\"> 80% of non-cancers correctly identified </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Positive Predictive Value </td>\n   <td style=\"text-align:left;\"> 24.7% </td>\n   <td style=\"text-align:left;\"> 25% of positive tests are true cancers </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Negative Predictive Value </td>\n   <td style=\"text-align:left;\"> 87.6% </td>\n   <td style=\"text-align:left;\"> 88% of negative tests are truly cancer-free </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Prevalence </td>\n   <td style=\"text-align:left;\"> 15.2% </td>\n   <td style=\"text-align:left;\"> 15% of population has prostate cancer </td>\n  </tr>\n  <tr>\n   <td style=\"text-align:left;\"> Likelihood Ratio </td>\n   <td style=\"text-align:left;\"> 1.83 </td>\n   <td style=\"text-align:left;\"> Positive test ~2× more likely in cancer </td>\n  </tr>\n</tbody>\n</table>\n\n`````\n:::\n:::\n\n\n## Summary\n\n| Measure | Formula | Interpretation |\n|---------|---------|----------------|\n| Sensitivity | a / (a + c) | Proportion of diseased correctly identified |\n| Specificity | d / (b + d) | Proportion of non-diseased correctly identified |\n| PPV | a / (a + b) | Probability of disease given positive test |\n| NPV | d / (c + d) | Probability of no disease given negative test |\n| Prevalence | (a + c) / n | Proportion of population with disease |\n| Likelihood ratio | Sens / (1 - Spec) | How much more likely is positive test in disease |\n| AUC | Area under ROC | Overall discriminative ability of test |\n",
    "supporting": [
      "10-screening-diagnostic_files"
    ],
    "filters": [
      "rmarkdown/pagebreak.lua"
    ],
    "includes": {
      "include-in-header": [
        "<script src=\"site_libs/kePrint-0.0.1/kePrint.js\"></script>\n<link href=\"site_libs/lightable-0.0.1/lightable.css\" rel=\"stylesheet\" />\n"
      ]
    },
    "engineDependencies": {},
    "preserve": {},
    "postProcess": true
  }
}